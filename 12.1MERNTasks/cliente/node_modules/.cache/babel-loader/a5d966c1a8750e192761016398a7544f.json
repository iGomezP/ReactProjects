{"ast":null,"code":"import _regeneratorRuntime from\"/home/vakaz/Documentos/React/12MERNTasks/cliente/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/vakaz/Documentos/React/12MERNTasks/cliente/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/vakaz/Documentos/React/12MERNTasks/cliente/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useReducer}from\"react\";import AuthContext from\"./AuthContext\";import AuthReducer from\"./AuthReducer\";import clienteAxios from\"../../config/axios\";import TokenAuth from\"../../config/tokenAuth\";import{REGISTRO_EXITOSO,REGISTRO_ERROR,OBTENER_USUARIO,LOGIN_EXITOSO,LOGIN_ERROR,CERRAR_SESION}from\"../../types\";import{jsx as _jsx}from\"react/jsx-runtime\";var AuthState=function AuthState(props){// State inicial\nvar initialState={token:localStorage.getItem('token'),autenticado:null,usuario:null,mensaje:null,cargando:true};// Inicializacion del reducer\nvar _useReducer=useReducer(AuthReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];// Funciones\nvar RegistrarUsuario=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(datos){var respuesta,alerta;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return clienteAxios.post('/api/usuarios',datos);case 3:respuesta=_context.sent;// console.log( respuesta.data );\ndispatch({type:REGISTRO_EXITOSO,payload:respuesta.data});// Obtener el usuario\nUsuarioAutenticado();_context.next=12;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](0);// console.log( error.response.data.msg );\nalerta={msg:_context.t0.response.data.msg,categoria:'alerta-error'};dispatch({type:REGISTRO_ERROR,payload:alerta});case 12:case\"end\":return _context.stop();}}},_callee,null,[[0,8]]);}));return function RegistrarUsuario(_x){return _ref.apply(this,arguments);};}();// Cuando el usuario inicia sesión\nvar IniciarSesion=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(datos){var respuesta,alerta;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return clienteAxios.post('/api/auth',datos);case 3:respuesta=_context2.sent;// console.log( respuesta );\ndispatch({type:LOGIN_EXITOSO,payload:respuesta.data});// Obtener el usuario\nUsuarioAutenticado();_context2.next=13;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0.response.data.msg);alerta={msg:_context2.t0.response.data.msg,categoria:'alerta-error'};dispatch({type:LOGIN_ERROR,payload:alerta});case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[0,8]]);}));return function IniciarSesion(_x2){return _ref2.apply(this,arguments);};}();// Retorna el usuario autenticado\nvar UsuarioAutenticado=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var token,respuesta;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:token=localStorage.getItem('token');if(token){// Función para enviar el token por headers\nTokenAuth(token);}_context3.prev=2;_context3.next=5;return clienteAxios.get('/api/auth');case 5:respuesta=_context3.sent;// console.log(  );\ndispatch({type:OBTENER_USUARIO,payload:respuesta.data.usuario});_context3.next=13;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](2);console.log(_context3.t0.response);dispatch({type:LOGIN_ERROR});case 13:case\"end\":return _context3.stop();}}},_callee3,null,[[2,9]]);}));return function UsuarioAutenticado(){return _ref3.apply(this,arguments);};}();// Cierra la sesión del usuario\nvar CerrarSesion=function CerrarSesion(){dispatch({type:CERRAR_SESION});};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{// ¿ States\ntoken:state.token,autenticado:state.autenticado,usuario:state.usuario,mensaje:state.mensaje,cargando:state.cargando,// ¿ Funciones\nRegistrarUsuario:RegistrarUsuario,IniciarSesion:IniciarSesion,UsuarioAutenticado:UsuarioAutenticado,CerrarSesion:CerrarSesion},children:props.children});};export default AuthState;","map":{"version":3,"sources":["/home/vakaz/Documentos/React/12MERNTasks/cliente/src/context/autenticacion/AuthState.jsx"],"names":["useReducer","AuthContext","AuthReducer","clienteAxios","TokenAuth","REGISTRO_EXITOSO","REGISTRO_ERROR","OBTENER_USUARIO","LOGIN_EXITOSO","LOGIN_ERROR","CERRAR_SESION","AuthState","props","initialState","token","localStorage","getItem","autenticado","usuario","mensaje","cargando","state","dispatch","RegistrarUsuario","datos","post","respuesta","type","payload","data","UsuarioAutenticado","alerta","msg","response","categoria","IniciarSesion","console","log","get","CerrarSesion","children"],"mappings":"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","sourcesContent":["import { useReducer } from \"react\";\nimport AuthContext from \"./AuthContext\";\nimport AuthReducer from \"./AuthReducer\";\nimport clienteAxios from \"../../config/axios\";\nimport TokenAuth from \"../../config/tokenAuth\";\nimport {\n  REGISTRO_EXITOSO,\n  REGISTRO_ERROR,\n  OBTENER_USUARIO,\n  LOGIN_EXITOSO,\n  LOGIN_ERROR,\n  CERRAR_SESION\n} from \"../../types\";\n\nconst AuthState = props => {\n\n  // State inicial\n  const initialState = {\n    token: localStorage.getItem( 'token' ),\n    autenticado: null,\n    usuario: null,\n    mensaje: null,\n    cargando: true\n  }\n\n  // Inicializacion del reducer\n  const [ state, dispatch ] = useReducer( AuthReducer, initialState );\n\n  // Funciones\n  const RegistrarUsuario = async datos => {\n\n    try {\n\n      const respuesta = await clienteAxios.post( '/api/usuarios', datos );\n      // console.log( respuesta.data );\n\n      dispatch( {\n        type: REGISTRO_EXITOSO,\n        payload: respuesta.data\n      } );\n\n      // Obtener el usuario\n      UsuarioAutenticado();\n\n    } catch ( error ) {\n      // console.log( error.response.data.msg );\n      const alerta = {\n        msg: error.response.data.msg,\n        categoria: 'alerta-error'\n      }\n\n      dispatch( {\n        type: REGISTRO_ERROR,\n        payload: alerta\n      } );\n    }\n  };\n\n  // Cuando el usuario inicia sesión\n  const IniciarSesion = async datos => {\n\n    try {\n\n      const respuesta = await clienteAxios.post( '/api/auth', datos );\n      // console.log( respuesta );\n      dispatch( {\n        type: LOGIN_EXITOSO,\n        payload: respuesta.data\n      } );\n\n      // Obtener el usuario\n      UsuarioAutenticado();\n\n    } catch ( error ) {\n      console.log( error.response.data.msg );\n      const alerta = {\n        msg: error.response.data.msg,\n        categoria: 'alerta-error'\n      }\n\n      dispatch( {\n        type: LOGIN_ERROR,\n        payload: alerta\n      } );\n    }\n  };\n\n  // Retorna el usuario autenticado\n  const UsuarioAutenticado = async () => {\n    const token = localStorage.getItem( 'token' );\n    if ( token ) {\n      // Función para enviar el token por headers\n      TokenAuth( token );\n    }\n\n    try {\n\n      const respuesta = await clienteAxios.get( '/api/auth' );\n      // console.log(  );\n\n      dispatch( {\n        type: OBTENER_USUARIO,\n        payload: respuesta.data.usuario\n      } )\n\n    } catch ( error ) {\n      console.log( error.response );\n      dispatch( {\n        type: LOGIN_ERROR\n      } )\n    }\n  };\n\n  // Cierra la sesión del usuario\n  const CerrarSesion = () => {\n    dispatch( {\n      type: CERRAR_SESION\n    } )\n  }\n\n  return (\n    <AuthContext.Provider\n      value={ {\n        // ¿ States\n        token: state.token,\n        autenticado: state.autenticado,\n        usuario: state.usuario,\n        mensaje: state.mensaje,\n        cargando: state.cargando,\n        // ¿ Funciones\n        RegistrarUsuario,\n        IniciarSesion,\n        UsuarioAutenticado,\n        CerrarSesion\n      } }\n    >\n      { props.children }\n    </AuthContext.Provider>\n  )\n}\n\nexport default AuthState;"]},"metadata":{},"sourceType":"module"}